
<!DOCTYPE html>
<html class="no-js" lang="en" class="js flexbox canvas canvastext webgl no-touch geolocation postmessage no-websqldatabase indexeddb hashchange history draganddrop websockets rgba hsla multiplebgs backgroundsize borderimage borderradius boxshadow textshadow opacity cssanimations csscolumns cssgradients no-cssreflections csstransforms csstransforms3d csstransitions fontface generatedcontent video audio localstorage sessionstorage webworkers applicationcache svg inlinesvg smil svgclippaths">
<head id="ContentPlaceHolderDefault_Head1">
    <meta http-equiv="X-UA-Compatible" content="IE=9,chrome=1" />
    <meta charset="utf-8" />
    <title>Windows Azure Training Kit - Building and Publishing Node.js Applications with Windows Azure Web Sites (OS X)</title>
    <link rel="Stylesheet" type="text/css" media="all" href="styles/master.css" />
</head>
<body id="top" class="page-">
    <div id="page">
        <div id="wrapper" class="landingPage getStartedPage">            
            <div class="header">								
				<img alt="Windows Azure" src="images/azure-logo.png" />
				<span class="mainHomepageSubTitle">Training Kit - June 2012 Update</span>								
			</div>			
			<div class="nav-menu-header">
				<nav>
					<ul>
						<li class="MenuLink-Selected">
							<a href="#">Content</a>
						</li>
											</ul>
				
										
						<span id="github-btn" class="github-btn">
						  <a id="gh-btn" title="Fork this repo in GitHub" href="https://github.com/WindowsAzure-TrainingKit/HOL-NodejsAzureWebSites-OSX" target="_blank" class="gh-btn">
							<span class="gh-ico"></span>
							<span id="gh-text" class="gh-text">Fork</span>
						  </a>								  
						</span>								
						<span id="github-btn" class="github-btn github-watchers">
						  <a id="gh-btn" title="Watch this repo in GitHub" href="https://github.com/WindowsAzure-TrainingKit/HOL-NodejsAzureWebSites-OSX" target="_blank" class="gh-btn">
							<span class="gh-ico"></span>
							<span id="gh-text" class="gh-text">Watch</span>
						  </a>								  
						</span>
						
									
				</nav>
			</div>	        
		</span>
			<div id="content" class="textpage">
            <section id="content-container">
				<div id="content" class="textpage">
			    <a name="top"></a>
				
				

		<div class="content">
			<?xml version="1.0" encoding="iso-8859-1"?><span><p><a name="Title"></a></p>

<h1 id="Building_and_Publishing_Nodejs_Applications_with_Windows_Azure_Web_Sites_OS_X">Building and Publishing Node.js Applications with Windows Azure Web Sites (OS X)</h1>

<hr />

<p><a name="Overview"></a></p>

<h2 id="Overview">Overview</h2>

<p>In this hands-on lab, you will learn the basics of the Windows Azure Web Sites service for Node.js applications. In Exercise 1, you will see how to use the Windows Azure portal for creating a web site and then publish a &quot;Hello World&quot; Node.js application using GIT. In Exercise 2, you will learn how to use the Windows Azure Command-Line Tools for publishing applications. 
<a name="Objectives"></a></p>

<h3 id="Objectives">Objectives</h3>

<p>In this hands-on lab, you will learn how to create and publish a Node.js application using:</p>

<ul>
<li>Git</li>
<li>Windows Azure Command-Line Tools for Mac and Linux</li>
</ul>

<p><a name="Prerequisites"></a></p>

<h3 id="Prerequisites">Prerequisites</h3>

<p>The following is required to complete this hands-on lab:</p>

<ul>
<li><a href="http://git-scm.com/">Git Version Control System</a> </li>
<li><a href="http://nodejs.org/#download">Node.js</a> </li>
<li><p><a href="https://www.windowsazure.com/en-us/develop/nodejs/how-to-guides/command-line-tools/">Windows Azure Command-Line Tools for Mac and Linux</a> (for Exercise 2 only)</p>
<blockquote>
<p><strong>Note:</strong> If you do not have Windows Azure Command-Line Tools for Mac and Linux installed, open a terminal and run the following command:</p>

<span class="codelanguage">ShellScript</span><pre><code class="ShellScript">sudo npm install azure -g
</code></pre>

<p>By using -g, Windows Azure Command-Line Tools will install on your machine globally. That means, you will be able to execute azure commands from any location.</p>
</blockquote></li>
<li><p>A Windows Azure subscription with the Web Sites Preview enabled - you can sign up for free trial <a href="http://bit.ly/WindowsAzureFreeTrial">here</a></p></li>
</ul>
<blockquote>
<p><strong>Note:</strong> This lab was designed to use the OS X Operating System.</p>
</blockquote>
<hr />

<p><a name="Exercises"></a></p>

<h2 id="Exercises">Exercises</h2>

<p>This hands-on lab includes the following exercises:</p>

<ol>
<li><a href="#Exercise1">Building and Publishing a Node.js Web Site using GIT</a></li>
<li><a href="#Exercise2">Building and Publishing a Node.js Web Site using the Command-Line Tools</a></li>
</ol>

<hr />

<p><a name="Exercise1"></a></p>

<h3 id="Exercise_1_Building_and_Publishing_a_Nodejs_Web_Site_using_GIT">Exercise 1: Building and Publishing a Node.js Web Site using GIT</h3>

<p>In the first exercise you will create a new web site from the Windows Azure portal, create a 'Hello World' Node.js application and finally publish it, taking advantage of the new GIT publishing feature provided by Windows Azure.</p>

<p><a name="Ex1Task1"></a></p>

<h4 id="Task_1_-_Creating_a_New_Web_Site_Hosted_in_Windows_Azure">Task 1 - Creating a New Web Site Hosted in Windows Azure</h4>

<ol>
<li><p>Go to the <a href="https://manage.windowsazure.com/">Windows Azure portal</a> <strong>Windows Azure portal</strong> and sign in using the <strong>Microsoft Account</strong> credentials associated with your subscription.</p>

<p><img src="images/log-in-into-windows-azure-portal.png?raw=true" alt="Log in into Windows Azure portal" title="Log in into Windows Azure portal" />
</p>

<p><em>Log on into Windows Azure portal</em></p></li>
<li><p>In Windows Azure portal home page, click the <strong>New</strong> button located on the bottom bar.</p>

<p><img src="images/creating-a-new-web-site.png?raw=true" alt="Creating a new web site" title="Creating a new Web Site" />
</p>

<p><em>Creating a new web site</em></p></li>
<li><p>Click <strong>Web Site | Quick Create</strong>. Provide an available URL for the new web site, select a region, and click <strong>Create Web Site</strong>.</p>

<p><img src="images/creating-a-new-web-site-using-quick-create-op.png?raw=true" alt="Creating a new Web Site using the Quick Create option" title="Creating a new Web Site using Quick Create option" />
</p>

<p><em>Creating a new Web Site using Quick Create option</em></p></li>
<li><p>Wait until the new web site is created.</p>

<p><img src="images/creating-new-web-site-status.png?raw=true" alt="Creating new web site status" title="Creating new web site status" />
</p>

<p><em>Creating new web site status</em></p></li>
<li><p>Once the web site is created click on the <strong>URL</strong> link to check that the new web site is working.</p>

<p><img src="images/browsing-to-new-site.png?raw=true" alt="Browsing to the new web site" title="Browsing to the new web site" />
</p>

<p><em>Browsing to the new web site</em></p>

<p><img src="images/web-site-running.png?raw=true" alt="Web site running" title="Web site running" />
</p>

<p><em>Web site running</em></p></li>
<li><p>Go back to the portal and click the web site name column to go to the site's dashboard.</p>

<p><img src="images/selecting-the-dashboard-tab.png?raw=true" alt="Selecting the dashboard tab" title="Selecting the dashboard tab" />
</p>

<p><em>Selecting the dashboard tab</em></p></li>
<li><p>Click the <strong>Set up Git publishing</strong> link.</p>

<p><img src="images/setting-up-git-publishing.png?raw=true" alt="Setting up Git Publishing" title="Setting up Git Publishing" />
</p>

<p><em>Setting up Git Publishing</em></p></li>
<li><p>Wait a few seconds until the Git repository is ready.</p>

<p><img src="images/git-repository-created.png?raw=true" alt="Git repository created" title="Git repository created" />
</p>

<p><em>Git repository created</em></p></li>
<li><p>Do not close the portal.</p></li>
</ol>

<p><a name="Ex1Task2"></a></p>

<h4 id="Task_2_-_Creating_a_new_Nodejs_Website">Task 2 - Creating a new Node.js Website</h4>

<ol>
<li><p>Create a new folder in a location that can be easily accessed.</p></li>
<li><p>Open your favorite text editor and copy the following code that will send the string <em>Hello World</em> to the browser. Save the file as <strong>server.js</strong> in the folder you have previously created.</p>

<span class="codelanguage">Javascript</span><pre><code class="Javascript"><span style="color:#0000FF">var</span> http = require(&#39;http&#39;);
<span style="color:#0000FF">var</span> port = process.env.port || 1337;
http.createServer(<span style="color:#0000FF">function</span> (req, res) {
                  res.writeHead(200, { &#39;Content-Type&#39;: &#39;text/plain&#39; });
                  res.end(&#39;Hello World\n&#39;);
}).listen(port);
</code></pre></li>
<li><p>Create a new text file and paste the following code. Save the file as <strong>package.json</strong> in the same folder.</p>

<span class="codelanguage">Json</span><pre><code class="Json">{
  &quot;name&quot;: &quot;HelloWorld&quot;,
  &quot;version&quot;: &quot;0.0.1&quot;,
  &quot;description&quot;: &quot;&quot;,
  &quot;main&quot;: &quot;./server.js&quot;,
  &quot;engines&quot;: { &quot;node&quot;: &quot;&gt;= 0.6.0&quot; }
}
</code></pre>
<blockquote>
<p><strong>Note:</strong> The package.json file tells the Node.js package manager (npm) how your package is structured, and which are the module dependencies. As this application is very simple it does not require dependencies, but in more complex applications you will probably need to specify a &quot;dependencies&quot; property. When publishing applications with Git, the Windows Azure platform automatically installs all the dependencies declared in this file.</p>
</blockquote></li>
<li><p>In the text editor create a new file and paste the following code. This configuration indicates that the <strong>server.js</strong> file is a Node.js application
that should be handled by the <strong>iisnode</strong> module.</p>
<blockquote>
<p><strong>Note:</strong> The <a href="https://github.com/tjanczuk/iisnode">iisnode</a> project provides a native IIS 7.x module that allows hosting of node.js applications in IIS 7.x.</p>
</blockquote>
<span class="codelanguage">XML</span><pre><code class="XML"><span style="color:#0000FF">&lt;?</span>xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;<span style="color:#0000FF">?&gt;</span>
<span style="color:#0000FF">&lt;</span><span style="color:#800000">configuration</span><span style="color:#0000FF">&gt;</span>
    <span style="color:#0000FF">&lt;</span><span style="color:#800000">system.webServer</span><span style="color:#0000FF">&gt;</span>
          <span style="color:#0000FF">&lt;</span><span style="color:#800000">modules</span> <span style="color:#FF0000">runAllManagedModulesForAllRequests</span>=<span style="color:#0000FF">&quot;false&quot;</span> <span style="color:#0000FF">/&gt;</span>

          <span style="color:#008000">&lt;!-- indicates that the server.js file is a node.js application 
            to be handled by the iisnode module --&gt;</span>
          <span style="color:#0000FF">&lt;</span><span style="color:#800000">handlers</span><span style="color:#0000FF">&gt;</span>
            <span style="color:#0000FF">&lt;</span><span style="color:#800000">add</span> <span style="color:#FF0000">name</span>=<span style="color:#0000FF">&quot;iisnode&quot;</span> <span style="color:#FF0000">path</span>=<span style="color:#0000FF">&quot;server.js&quot;</span> <span style="color:#FF0000">verb</span>=<span style="color:#0000FF">&quot;*&quot;</span> <span style="color:#FF0000">modules</span>=<span style="color:#0000FF">&quot;iisnode&quot;</span> <span style="color:#0000FF">/&gt;</span>
          <span style="color:#0000FF">&lt;/</span><span style="color:#800000">handlers</span><span style="color:#0000FF">&gt;</span>
          <span style="color:#0000FF">&lt;</span><span style="color:#800000">rewrite</span><span style="color:#0000FF">&gt;</span>
            <span style="color:#0000FF">&lt;</span><span style="color:#800000">rules</span><span style="color:#0000FF">&gt;</span>
              <span style="color:#0000FF">&lt;</span><span style="color:#800000">clear</span> <span style="color:#0000FF">/&gt;</span>
              <span style="color:#0000FF">&lt;</span><span style="color:#800000">rule</span> <span style="color:#FF0000">name</span>=<span style="color:#0000FF">&quot;app&quot;</span> <span style="color:#FF0000">enabled</span>=<span style="color:#0000FF">&quot;true&quot;</span> <span style="color:#FF0000">patternSyntax</span>=<span style="color:#0000FF">&quot;ECMAScript&quot;</span> <span style="color:#FF0000">stopProcessing</span>=<span style="color:#0000FF">&quot;true&quot;</span><span style="color:#0000FF">&gt;</span>
                <span style="color:#0000FF">&lt;</span><span style="color:#800000">match</span> <span style="color:#FF0000">url</span>=<span style="color:#0000FF">&quot;server\.js.+&quot;</span> <span style="color:#FF0000">negate</span>=<span style="color:#0000FF">&quot;true&quot;</span> <span style="color:#0000FF">/&gt;</span>
                <span style="color:#0000FF">&lt;</span><span style="color:#800000">conditions</span> <span style="color:#FF0000">logicalGrouping</span>=<span style="color:#0000FF">&quot;MatchAll&quot;</span> <span style="color:#FF0000">trackAllCaptures</span>=<span style="color:#0000FF">&quot;false&quot;</span> <span style="color:#0000FF">/&gt;</span>
                <span style="color:#0000FF">&lt;</span><span style="color:#800000">action</span> <span style="color:#FF0000">type</span>=<span style="color:#0000FF">&quot;Rewrite&quot;</span> <span style="color:#FF0000">url</span>=<span style="color:#0000FF">&quot;server.js&quot;</span> <span style="color:#0000FF">/&gt;</span>
              <span style="color:#0000FF">&lt;/</span><span style="color:#800000">rule</span><span style="color:#0000FF">&gt;</span>
            <span style="color:#0000FF">&lt;/</span><span style="color:#800000">rules</span><span style="color:#0000FF">&gt;</span>
          <span style="color:#0000FF">&lt;/</span><span style="color:#800000">rewrite</span><span style="color:#0000FF">&gt;</span>
    <span style="color:#0000FF">&lt;/</span><span style="color:#800000">system.webServer</span><span style="color:#0000FF">&gt;</span>
<span style="color:#0000FF">&lt;/</span><span style="color:#800000">configuration</span><span style="color:#0000FF">&gt;</span>
</code></pre></li>
<li><p>Save the file as <strong>web.config</strong> in your web site folder.</p></li>
</ol>

<p><a name="Ex1Task3"></a></p>

<h4 id="Task_3_-_Publishing_the_Nodejs_application_using_Git">Task 3 - Publishing the Node.js application using Git</h4>

<ol>
<li><p>Go back to the portal. Open the site's <strong>Dashboard</strong> and copy the <strong>Git Clone Url</strong> value from the bottom of the page.</p>

<p><img src="images/git-clone-url.png?raw=true" alt="Git Clone Url" />
</p>

<p><em>Copying the Git Clone Url</em></p></li>
<li><p>In order to publish your local files, open a <strong>Terminal</strong> console, change directories to your application folder and run the following commands.</p>

<span class="codelanguage">Terminal</span><pre><code class="Terminal">git init
git add .
git commit -m &quot;initial commit&quot;
</code></pre>
<blockquote>
<p><strong>Note:</strong> You can learn more about Git commands in <a href="http://git-scm.com/documentation">http://git-scm.com/documentation</a>.</p>
</blockquote></li>
<li><p>To add the remote Windows Azure repository and push the files, run the following commands. Replace the <em>{Git Clone Url}</em> placeholder with the value obtained from the portal.</p>

<span class="codelanguage">Terminal</span><pre><code class="Terminal">git remote add azure {Git Clone Url}
git push azure master
</code></pre></li>
<li><p>Enter the deployment credentials when prompted.</p>
<blockquote>
<p><strong>Note:</strong> Deployment credentials are other than the <strong>Microsoft Account</strong> associated with your Windows Azure subscription and are valid for use with all Windows Azure web sites associated with your subscription. If you don't know your deployment credentials you can easily reset them using the management portal. Open the web site <strong>Dashboard</strong> page and click the <strong>Reset deployment credentials</strong> link. Provide a new password and click Ok.</p>

<p><img src="images/deployment-credentials.png?raw=true" alt="Resetting the deployment credentials" title="Resetting the deployment credentials" />
</p>

<p><em>Resetting the deployment credentials</em></p>
</blockquote></li>
<li><p>Go to the site's <strong>Dashboard</strong> and click the <strong>Site Url</strong> link to ensure that the site is running. A <em>Hello Word</em> message will be shown.</p>

<p><img src="images/running-the-nodejs-application.png?raw=true" alt="Running the Node.js application" title="Running the Node.js application" />
</p>

<p><em>Running the Node.js application</em></p></li>
</ol>

<hr />

<p><a name="Exercise2"></a></p>

<h3 id="Exercise_2_Building_and_Publishing_a_Nodejs_Web_Site_using_the_Command-Line_Tools">Exercise 2: Building and Publishing a Node.js Web Site using the Command-Line Tools</h3>

<p>In this exercise, you will learn how manage web sites using the Windows Azure Command-Line Tools for Mac and Linux.</p>
<blockquote>
<p><strong>Note:</strong> These steps assume you have the Windows Azure Command-Line Tools for Mac and Linux installed.</p>
</blockquote>
<ol>
<li><p>Open a <strong>Terminal</strong> console and execute the following command to download your account's <strong>publish settings</strong> file. A new browser window will pop up. Log on using your <strong>Microsoft Account</strong> credentials associated with your Windows Azure subscription.</p>

<span class="codelanguage">Terminal</span><pre><code class="Terminal">azure account download
</code></pre>

<p>Your publish settings will be downloaded to your browser's default download folder (usually ~/Downloads) and a new page with relevant information will be displayed.</p>

<p><img src="images/download-publishsettings.png?raw=true" alt="Downloading the publish settings file" title="Downloading the publish settings file" />
</p>

<p><em>Downloading the publish settings file</em></p></li>
<li><p>Go back to the <strong>Terminal</strong> console and import the file downloaded in the previous step by running the following command, specifying the <strong>publish settings</strong> file location in the <em>{publish_settings_file}</em> placeholder.</p>

<span class="codelanguage">Terminal</span><pre><code class="Terminal">azure account import {publish_settings_file}
</code></pre></li>
<li><p>Execute <a href="#Ex1Task2">Task 2 from Exercise 1</a> to create a Node.js site, but placing the files in a different folder.</p></li>
<li><p>Go back to the <strong>Terminal</strong> console and change directories in order to go to the folder where you placed the files.</p></li>
<li><p>Run the following command to create the Windows Azure Web Site with <strong>GIT publishing</strong> feature enabled.</p>

<span class="codelanguage">Terminal</span><pre><code class="Terminal">azure site create --git
</code></pre>

<p>Provide a site name when prompted, for example <strong>nodejsappOSXcli</strong>. Then select a region and proceed.</p>

<p><img src="images/new-web-site-cli.png?raw=true" alt="Creating a new Web Site and enabling GIT publishing" title="Creating a new Web Site and enabling GIT publishing" />
</p>

<p><em>Creating a new Web Site and enabling GIT publishing</em></p>
<blockquote>
<p><strong>Note:</strong> By specifying <strong>--git</strong> when running the command <strong>site create</strong> you don't need to run additional commands to initialize the Git repository or add the git remote, since these two tasks will be done automatically by the Windows Azure Command-Line Tools.</p>
</blockquote></li>
<li><p>Now you will add the application files to a Git repository and push them to the Windows Azure Web Site. To do this, go back to the command prompt and execute the following commands. When prompted provide your deployment credentials.</p>

<span class="codelanguage">Terminal</span><pre><code class="Terminal">git add .
git commit -m &quot;initial commit&quot;
git push azure master
</code></pre>

<p><img src="images/push-site.png?raw=true" alt="Pushing the site files" title="Pushing the site files" />
</p>

<p><em>Pushing the site files</em></p>
<blockquote>
<p><strong>Note:</strong> Deployment credentials are other than the <strong>Microsoft Account</strong> associated with your Windows Azure subscription and are valid for use with all Windows Azure web sites associated with your subscription. If you don't know your deployment credentials you can easily reset them using the management portal. Open the web site <strong>Dashboard</strong> page and click the <strong>Reset deployment credentials</strong> link. Provide a new password and click Ok.</p>

<p><img src="images/deployment-credentials.png?raw=true" alt="Resetting the deployment credentials" title="Resetting the deployment credentials" />
</p>

<p><em>Resetting the deployment credentials</em></p>
</blockquote></li>
<li><p>Run the following command to open the published deployments for your site in Windows Azure portal.</p>

<span class="codelanguage">Terminal</span><pre><code class="Terminal">azure site portal
</code></pre>

<p>In Windows Azure portal, select your site from the list and open the <strong>Deployments</strong> page of the site. Check out the latest deployment.</p>

<p><img src="images/site-deployments.png?raw=true" alt="Site deployments" title="Site deployments" />
</p>

<p><em>Site deployments</em></p></li>
<li><p>Execute the following command to browse to the published web site and make sure it works.</p>

<span class="codelanguage">Terminal</span><pre><code class="Terminal">azure site browse
</code></pre>

<p><img src="images/website-working-cli.png?raw=true" alt="Web site working" title="Web site working" />
</p>

<p><em>Web site working</em></p></li>
</ol>

</span>
		</div>
	<br />
	<p><a href="#top">top of page</a></p>


				</div>
			</section>
			<footer>
				<div class="footer-sitemap" style="border-top:0"></div>
				<div class="footer-bottom">
					<ul>
						<li class="footer-copyright"><a href="http://www.microsoft.com"><img alt="microsoft" src="images/microsoft.png" /></a></li>					
												<li><a href="https://github.com/WindowsAzure-TrainingKit/HOL-NodejsAzureWebSites-OSX/issues" target="_new">File an Issue</a></li>
												<li><a href="mailto:azcfeed@microsoft.com?subject=Windows Azure Training Kit">Contact Us</a></li>						
						<li><a href=".\">Browse Content</a></li>
						<li>&copy; 2012 Microsoft</li>
					</ul>
				</div>
			</footer>
			</div>
        </div>
    </div>
</body>
</html>

